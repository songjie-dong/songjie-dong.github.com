
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>All Things Coding</title>
  <meta name="author" content="Songjie Dong">

  
  <meta name="description" content="tips 翻译水平有待提高.部分内容添加了个人的理解. 前言 在Zen And The Art Of Scaling - A Koan And Epigram Approach这篇文章中,Russell Sullivan提出了一个有趣的猜想:存在20个经典的瓶颈.这听起来疑似那个&#8221; &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://songjie-dong.github.com/blog/page/2/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="All Things Coding" type="application/atom+xml">
  <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-36155507-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <div id="logo">
  	<div id="logoLeft">{</div>
  	<div id="logoText">dsj</div>
  	<div id="logoRight">}</div>
  	<div class="clear"></div>
  </div>
  <h1><a href="/">All Things Coding</a></h1>
  
    <h2>Coding Thinking Dreaming</h2>
  
  <div class="clear"></div>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:songjie-dong.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about/about.html">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2013/04/01/big-list-of-20-common-bottlenecks/">Big List of 20 Common Bottlenecks</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2013-04-01T20:04:00+08:00" pubdate data-updated="true">Apr 1<span>st</span>, 2013</time>
        
         | <a href="/blog/2013/04/01/big-list-of-20-common-bottlenecks/#disqus_thread">Comments</a>
		 
	  </p>
    
  </header>


  <div class="entry-content"><h2>tips</h2>

<p>翻译水平有待提高.部分内容添加了个人的理解.</p>

<h2>前言</h2>

<p>在<a href="http://highscalability.com/blog/2012/2/27/zen-and-the-art-of-scaling-a-koan-and-epigram-approach.html">Zen And The Art Of Scaling - A Koan And Epigram Approach</a>这篇文章中,Russell Sullivan提出了一个有趣的猜想:存在20个经典的瓶颈.这听起来疑似那个&#8221;只有20个基本的故事情节&#8221;的想法.这完全取决于你看瓶颈的视角,也许这个想法是对的,但实践过程中我们都知道瓶颈来自于无穷的&#8221;味道&#8221;,所有的酸和灰.</p>

<ul>
<li>chunkify这个单词翻译的太纠结了,没明白啥意思,先意会一下吧.</li>
<li>酸我能理解是个味道,灰是啥&#8230;&#8230;.</li>
<li>sullivan在分布式数据库方面很牛,Alchemy Database没怎么研究过呢还,但是卖点是混合型数据库,貌似是redis+server side script实现,参考<a href="http://highscalability.com/blog/2012/2/27/zen-and-the-art-of-scaling-a-koan-and-epigram-approach.html">zen and the art of scaling</a></li>
</ul>


<p>有一天<a href="http://jsoftbiz.wordpress.com/">Aurelien</a>发送了他的瓶颈列表给我, 我们cc给了Russell,他给了我他的列表,我也有一份列表,于是产生了一份石头汤</p>

<ul>
<li><a href="http://en.wikipedia.org/wiki/Stone_Soup">石头汤</a></li>
</ul>


<p>Russell说这是他的&#8221;我希望在我年轻的时候我知道&#8221;列表,我想应该用一种不断充实的方式来看待它:拥有更多的经验,处理更多不同类型的项目,会有更多的教训你能够添加到这份列表中.当你读到这份列表,并且制作自己的列表时,你正在通过多年积累的经验和一点点挫折而不断变强,并且其中每一条都有一个故事值得grokking.</p>

<ul>
<li>grokking 实在是无法用一个词汇来描述&#8230;.</li>
</ul>


<h2>瓶颈的个人理解</h2>

<h3>Database:</h3>

<ul>
<li><p>Working size exceeds available RAM</p>

<p>工作内存超过了系统可用的内存,可能会大量出现malloc失败或者触发swap区不断的换入换出,或者触发内存碎片整理这种成本较高的动作.对于数据库来说,性能应该会下降的很快,这个不用说,内存总是比硬盘快.基本上离挂不远.</p></li>
<li><p>Long &amp; short running queries</p>

<p>耗时较长的查询会占用系统资源一段较长的时间无法释放,会带来性能的波动.通常来说,业务上对于数据查询的场景是属于OLTP or OLAP需要分析清楚先,并以此作为技术选型的评估因素之一.</p></li>
<li><p>Write-write conflicts</p>

<p>大量的并发写冲突问题,此问题我分为两种情况:对系统整体的影响,热点的问题.</p>

<ul>
<li><p>整体的影响如何解决?</p>

<p>Sharding strategies often involve two techniques: partitioning and replication. With partitioning, the data is divided into small chunks and stored across many computers. Each of these chunks is small enough that the computer that stores it can efficiently manipulate and query the data. With the other technique of replication, multiple copies of the data are stored across several machines. Since each copy runs on its own machine and can respond to queries, the system can efficiently respond to tons of queries for the same data by adding more copies. Replication also makes the system resilient to failure because if any one copy is broken or corrupt, the system can use another copy for the same task.</p></li>
<li><p>热点</p>

<p>scale up性能,比如数据库热点数据,可以单独拿出来提供服务.热点操作的针对性优化,比如对于计数器场景,cpu做必要的优化,写可以用thread local or array + padding.</p></li>
</ul>
</li>
<li><p>Large joins taking up memory</p>

<p>尽量避免两张大表join,将sql拆开为两次简单查询是一种解救办法,但可能会出现too much short running queries问题,需要结合性能数据分析权衡ROI
.</p></li>
</ul>


<h3>Virtualisation:</h3>

<p>这个领域&#8230;比较小白啊,先放着</p>

<ul>
<li><p>Sharing a HDD, disk seek death</p></li>
<li><p>Network I/O fluctuations in the cloud</p></li>
</ul>


<h3>Programming:</h3>

<ul>
<li><p>Threads: deadlocks, heavyweight as compared to events, debugging, non-linear scalability, etc&#8230;</p></li>
<li><p>Event driven programming: callback complexity, how-to-store-state-in-function-calls, etc&#8230;</p>

<p>callback的复杂性:callback有两种,block callback&amp;async callback,通常这种模式提供给模块使用者,来扩展已有功能的一种方式.我个人感觉上callback对于一些严谨的模块维护者来说,侵入性较强,难以控制.模块使用者会比较容易写出破坏接口语义的实现,特别是对于async的接口.</p>

<p>store state&#8230;不知所云</p></li>
<li><p>Lack of profiling, lack of tracing, lack of logging</p>

<p>使用成熟的工具,提供profiling是必须的.
跟踪&#8212;分布式环境跟踪是个问题,事件需要统一收集和分析,etc..kafka
logging &#8211;例子很多了.不用一台台scp download日志,否则会疯了.</p></li>
<li><p>One piece can&#8217;t scale, SPOF, non horizontally scalable, etc&#8230;</p>

<p>可扩展性是架构设计需要解决的基本问题,但也是非常复杂的问题,无状态,分区可扩展性.</p></li>
<li><p>Stateful apps</p>

<p>有状态就可能涉及到状态的持久化问题,同时状态的可靠性持久化需要一些复杂的的机制来保证:write ahead logging, quorum, replication,raid,paxos etc&#8230;</p></li>
<li><p>Bad design : The developers create an app which runs fine on their computer. The app goes into production, and runs fine, with a couple of users. Months/Years later, the application can&#8217;t run with thousands of users and needs to be totally re  architectured and rewritten.</p>

<p>这事天天发生</p></li>
<li><p>Algorithm complexity</p>

<p>复杂意味着维护性问题,可扩展性问题,调优问题.</p></li>
<li><p>Dependent services like DNS lookups and whatever else you may block on.</p>

<p>前端性能优化&#8230;域名可以拆分,但不能过多.</p></li>
<li><p>Stack space</p>

<p>栈还是有开销的&#8230;.特别是对于线程创建后的栈固定分配时,线程创建的开销还是不可忽视的,虽然有所谓的copy on write优化&#8230;
无其他想法了,除了line优化降低栈深度.</p></li>
</ul>


<p>以后在补充吧.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2013/01/28/ye-ye-de-liang-san-shi/">爷爷的两三事</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2013-01-28T21:40:00+08:00" pubdate data-updated="true">Jan 28<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/01/28/ye-ye-de-liang-san-shi/#disqus_thread">Comments</a>
		 
	  </p>
    
  </header>


  <div class="entry-content"><p>两周前到西湖苏堤去看夕阳,顺便游览了一番,游玩时想到爷爷,他是浙江人,也因为他以前在世时的两三事,途中偶尔会天真的幻想爷爷还在世我们讨论的话题会是&#8230;..</p>

<p>说起爷爷,小时候经常翻阅爷爷的藏书,都是繁体书,印象中较为深刻的是爷爷买的书都会在第一页写上江贤端购于xx地,年月日的字样,本本如此,如今这个遍地物质精神快餐的时代,谁还会有如此雅兴.至于哪些书已经完全记不得,只是在爷爷去世时,我保留了一本繁体版的史记,纸质早已发黄,此书我只看过与刺客列传相关的内容,惭愧,惭愧.</p>

<p>爷爷让我印象深刻的地方还有他70岁了还在学习英语,而且方式就是听广播,那时我刚刚上初中开始学习英语,印象中爷爷最喜欢与我讨论英语知识,有时教的不对还会特意走到我家来纠正之前的错误,怪我少不更事,如今想来,爷爷这样的人在现代社会实在是太少了,我们这代80后到了70岁坚持学习的人能有多少?</p>

<p>爷爷还会很有雅兴的养养金鱼,种种盆景啥的,盆景不大,白天有空的时候我偶尔会跟着爷爷在阳台发呆,虽不太懂得欣赏盆景,但很好奇这种植物为啥值得天天看,还得修剪.</p>

<p>至于爷爷对我的偏爱,爷爷毫不掩饰,周末都会带我到公园去玩,蹦床一玩就是一个下午,一个6,70岁的老人就这么陪着我度过了无数个这样的下午,有一次玩到没钱了,爷爷还去找公园里不认识的人借钱,哎,被我逼到这份上了.</p>

<p>大学时去杭州玩,特意要求去浙大拍了张照,我不是喜欢拍照的人,但是我想去看看爷爷读过书的地方,从而能在内心根据这些积攒下来的记忆拼凑爷爷在我心中的印象.我觉得爷爷是那个时代的知识分子,毕竟那时候能读大学的人并不多,何况是浙大.</p>

<p>爷爷走的很辛苦,多年的支气管炎,一到武汉的冬天就必须得住院,那时家里都不富裕,最后爷爷也不愿意去医院了,就在那年走了,爷爷其实有个妹妹,家里还算富足,想来爷爷也是做好了打算,并无留恋之意才执意不去医院的.</p>

<p>哎,如果能再和您说上一次话,我想我会少走很多弯路,如果能再吃上您炒的油盐饭,鱼香肉丝,风干羊腿火锅,我一定会感动的痛哭流涕,如果能再与您讨论英语学习,我想我也不会痛恨这门课程,如果您还在,或许我们可以一起痛骂世道不古,把老一代知识分子的精神全都丢了的时代,又或许与您一起畅游西湖,回忆您的往事,我想一定会很精彩.</p>

<p>一直都是眼含泪水的写到这里,因为很遗憾我当时的少不更事,碌碌无为.遗憾是生命中最残忍的事情,希望您能在天上好好的看着我,看着我的成长,并非是我现在有多么好,而是我会尽一生接近您想要的人间正道.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2012/11/15/is-parallel-programming-hard-2/">Is Parallel Programming Hard? - 2</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2012-11-15T14:39:00+08:00" pubdate data-updated="true">Nov 15<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/11/15/is-parallel-programming-hard-2/#disqus_thread">Comments</a>
		 
	  </p>
    
  </header>


  <div class="entry-content"><h2>问题</h2>

<p>CAS是否是绝对的灵丹妙药呢?</p>

<h2>测试</h2>

<p>根据并发编程实践中的结论,极端的竞争条件下,Lock表现出比CAS更好的性能,在中等的竞争条件下,CAS明显胜出.</p>

<h2>Is parallel programming hard 书中关于CAS过程的分析</h2>

<p>对于一次CAS操作,如果是最好的情况:当前处理的core的l1 cache line 命中,则直接操作,如果miss,则会通过Interconnect通讯其他core,寻找CAS操作的数据,core间传输数据的开销不低,在4-CPU 1.8GHz AMD Opteron 844 System上,整个miss的CAS操作需要500个clock cycle.而命中的情况下只需要63个clock cycle.</p>

<p>另外java里实现的CAS都有一定数量的spin操作,如果大量的竞争失败,对于CPU来说则是做了很多无用功.</p>

<h2>结论</h2>

<p>吞吐量的测试结果是在高并发的情况下:CAS的miss开销+CPU无用功 > Lock的开销(context switch, cache miss).</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2012/11/08/fen-zhi-yu-ce-de-xian-jing/">分支预测的迷思</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2012-11-08T18:29:00+08:00" pubdate data-updated="true">Nov 8<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/11/08/fen-zhi-yu-ce-de-xian-jing/#disqus_thread">Comments</a>
		 
	  </p>
    
  </header>


  <div class="entry-content"><h2>What</h2>

<p>首先,看看什么是分支预测,这个技术的出现是由于CPU技术的进步,现代CPU都采用了流水线结构,而且流水线越深(按深入理解计算机提到的是15),利用率越高,但流水线引入了一个问题,就是需要预先将指令取出并reordering再放入流水线,而程序中的分支则导致无法预取指令,必须等到evaluate条件指令之后才能确定,这会导致流水线无法充分利用.本文介绍一些基本的关于分支预测的概念和实现方式,具体的概念和资料请参考<a href="http://zh.wikipedia.org/zh/%E5%88%86%E6%94%AF%E9%A0%90%E6%B8%AC%E5%99%A8">分支预测器</a></p>

<p>intel官方数据分支预测器能保证在工业测试中达到94%+的成功率,但这就像intel官方宣布的MIPS一样不靠谱,实际的情况有时会不如人意,分支预测成功率低会导致流水线需要重新取指并reordering,大约开销在20 clock cycle以内(数据各有差异,但我没看到20以上的),通常在5%以上就值得关注,10%以上就难以忍受了.</p>

<h2>分支预测的主流技术</h2>

<p>分支预测需要做两件事:
1. 预测branch可能的方向
2. 从BTB中找到对应的PC地址,取指并reording(实际情况步骤会更多)</p>

<p>BTB可以理解为一个hashmap,里面保存了某branch对应方向对应的需执行指令地址,BTB大小有限.</p>

<p>预测算法:</p>

<ol>
<li><p>饱和计数
使用两个bit保存具备4种状态的状态机,状态机具有强不选择,弱不选择,弱选择,强选择,说简单点就是只有两次选择到同样的分支,状态机才会选择改变分支方向,早期的奔腾系列使用了这种方法,测试结果达到93.5%的准确率,但我们很容易就可以发现它的弱点.</p></li>
<li><p>两级自适应预测器
记录n次branch history的结果作为一个当前模式,同时存在一个pattern history table,这里面记录了n个长度模式和n个对应的饱和计数器.简而言之这是一个基于模式识别,具备很强的预测模式能力的预测器.
通常来说,每个分支都需要一个独立的pattern history table,称之为本地分支预测,但考虑到对于m条分支预测指令,n次长度的历史模式来说,需要消耗的内存极大,所以有了全局分支预测,它提供了共享的pattern history table,好处是如果多条分支预测相同,则可以共享预测的效果,但如果多条分支只在部分情况下共享分支结果则适得其反.本地分支预测达到了97.1%的准确率,全局分支预测则为96.6%,当然我们需要费点力气才能发现它们的弱点.</p></li>
<li><p>静态预测
总是用一种方向来预测.编译器可以提供hint给cpu,适用类似if (xxx == null)的场景.</p></li>
<li><p>循环分支预测
对于现代cpu都会对loop的跳出条件做特殊优化,他会记录条件值和当前循环次数,当达到退出条件时直接预测跳出,这个计数值不会无限大,intel官方数据是16,也有说64的.</p></li>
<li><p>融合分支预测
本地和全局预测组合.</p></li>
</ol>


<h2>案例&amp;分析</h2>

<p>以下列举一些在intel core 2上的测试用例,用例只涉及到对某些具体模式的分支情况做讨论,不涉及实际应用中的复杂模式以及资源竞争的影响,同时结论也不一定适用于其他类型的CPU,这么做的原因在于:对分支预测来说,难以给出统一的结论性原则,但我们需要考虑如何识别潜在分支预测失败因子以及更重要的避免不必要的预测,或者消除它们.</p>

<p>数据采集使用perf这个linux下的系统性能调优工具,我们用该工具来获取分支预测数据,<a href="http://www.ibm.com/developerworks/cn/linux/l-cn-perf1/index.html">介绍</a>,vtune是intel官方的分析工具,有空可以装来玩玩.</p>

<p>单表达式随机化:</p>

<figure class='code'><figcaption><span>single condition  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>  <span class="n">Random</span> <span class="n">random</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">(</span><span class="n">seed</span><span class="o">);</span>
</span><span class='line'>  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">64</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="c1">//do something</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>            <span class="c1">//do something</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>这是一个最为简单,貌似看起来也很具有破坏性的例子,但是intel是强大的,根据一些分析,intel使用了多种预测器的组合,同时具备很强的自适应性,so结果很惊人:
branch-misses 2%-3% of all branches</p>

<p>结果基本在3%以内,也就是97%的准确率,由于intel对于分支预测并未公开过细节,所以不做过多讨论.</p>

<p>增加一个判断条件:</p>

<figure class='code'><figcaption><span>multi-condition  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>  <span class="n">Random</span> <span class="n">random</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">(</span><span class="n">seed</span><span class="o">);</span>
</span><span class='line'>  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">64</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">||</span> <span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="c1">//do something</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>            <span class="c1">//do something</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>结果:
branch-misses 8%-12% of all branches</p>

<p>注意我的这个case,if判断内两个表达式都完全随机,两者毫无关联,此时miss率上升到8%-9%,随着我不断在if中加入随机性的表达式,miss率逐步提到12%左右.</p>

<p>失败模式:单if多随机表达式的杀伤力很强,消除方法可以考虑合并二者,比如上面的例子可以将表达式相加判断是否大于1,复杂情况考虑各种淫荡的位操作.</p>

<p>还有一种方式适用于表达式与loop无关的场景,可以将if外提,从而消除分支预测(编译优化).预测即使miss率很低也会消耗很多资源,而影响到其他的branch.</p>

<p>多条件分支:</p>

<figure class='code'><figcaption><span>if-else-condition  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>  <span class="n">Random</span> <span class="n">random</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">(</span><span class="n">seed</span><span class="o">);</span>
</span><span class='line'>  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">64</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">8</span><span class="o">)</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="c1">//do something</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">8</span><span class="o">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">{</span>
</span><span class='line'>            <span class="c1">//do something    ... next else if </span>
</span><span class='line'>        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>            <span class="c1">//do something</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>这种场景同样会带来5-8%左右的miss率,这个case中参数完全随机,现实中不太会出现这样的情况,这种模式在部分情况下可以用mapping的方式去消除.</p>

<p>循环退出条件的优化-循环展开:</p>

<figure class='code'><figcaption><span>before loop-unrolling  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">65</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">]</span> <span class="o">=</span> <span class="n">j</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>after loop-unrolling  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">65</span><span class="o">;</span> <span class="n">j</span><span class="o">+=</span><span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">]</span> <span class="o">=</span> <span class="n">j</span><span class="o">;</span>
</span><span class='line'>        <span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>将循环表达式中innerloop的循环次数降到64(需要考虑CPU的实现)以下,则可以使用CPU的循环分支预测器.
这种方式如果两层循环,且外循环很大的情况下容易出现问题.展开的坏处是代码量增加,好处是分支预测效率高,占用资源少,同时指令可以充分利用流水线和并行.由于在我的机器上对于这种场景难以复现,我就没提供测试数据对比.但loop-unrolling是分支预测典型的优化方式之一.</p>

<p>最后这个场景代码逻辑是在一个大的int二维数组中按随机顺序造了一些测试的奇偶数序列,然后在循环的条件分支中判断奇偶数,一共有10个case,它们的长度分别是2,2+1,4,4+1,8,8+1,16,16+1,32,32+1,另外测试条件是多表达式.</p>

<figure class='code'><figcaption><span>branch predictor test  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
</span><span class='line'>      <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
</span><span class='line'>      <span class="kt">int</span><span class="o">[][]</span> <span class="n">randoms</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[][]</span> <span class="o">{</span>
</span><span class='line'>              <span class="k">new</span> <span class="kt">int</span><span class="o">[]{</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">},</span>
</span><span class='line'>              <span class="k">new</span> <span class="kt">int</span><span class="o">[]{</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">2</span><span class="o">},</span>
</span><span class='line'>              <span class="k">new</span> <span class="kt">int</span><span class="o">[]{</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">},</span>
</span><span class='line'>              <span class="k">new</span> <span class="kt">int</span><span class="o">[]{</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">},</span>
</span><span class='line'>              <span class="k">new</span> <span class="kt">int</span><span class="o">[]{</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">},</span>
</span><span class='line'>              <span class="k">new</span> <span class="kt">int</span><span class="o">[]{</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">},</span>
</span><span class='line'>              <span class="k">new</span> <span class="kt">int</span><span class="o">[]{</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">2</span><span class="o">},</span>
</span><span class='line'>              <span class="k">new</span> <span class="kt">int</span><span class="o">[]{</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">},</span>
</span><span class='line'>              <span class="k">new</span> <span class="kt">int</span><span class="o">[]{</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">},</span>
</span><span class='line'>              <span class="k">new</span> <span class="kt">int</span><span class="o">[]{</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">},</span>
</span><span class='line'>      <span class="o">};</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;branch predictor sequence length:&quot;</span> <span class="o">+</span> <span class="n">randoms</span><span class="o">[</span><span class="n">y</span><span class="o">].</span><span class="na">length</span><span class="o">);</span>
</span><span class='line'>      <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
</span><span class='line'>              <span class="k">if</span> <span class="o">(</span><span class="n">randoms</span><span class="o">[</span><span class="n">y</span><span class="o">][</span><span class="n">j</span><span class="o">%</span><span class="n">randoms</span><span class="o">[</span><span class="n">y</span><span class="o">].</span><span class="na">length</span><span class="o">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">||</span> <span class="n">randoms</span><span class="o">[</span><span class="n">y</span><span class="o">][</span><span class="n">i</span><span class="o">%</span><span class="n">randoms</span><span class="o">[</span><span class="n">y</span><span class="o">].</span><span class="na">length</span><span class="o">]</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                  <span class="n">x</span> <span class="o">=</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="o">;</span>
</span><span class='line'>              <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>                  <span class="n">x</span> <span class="o">=</span> <span class="n">j</span><span class="o">;</span>
</span><span class='line'>              <span class="o">}</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">x</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>测试脚本:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>  <span class="k">for </span>i in <span class="o">{</span>0..9<span class="o">}</span>
</span><span class='line'>  <span class="k">do</span>
</span><span class='line'><span class="k">    </span><span class="nb">echo</span> -e <span class="s2">&quot;test case:$i\n&quot;</span>
</span><span class='line'>    perf stat java GGG <span class="nv">$i</span>
</span><span class='line'>  <span class="k">done</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>result </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>test case:0
</span><span class='line'>
</span><span class='line'>branch predictor sequence length:2
</span><span class='line'>99999
</span><span class='line'>
</span><span class='line'> Performance counter stats for 'java GGG 0':
</span><span class='line'>
</span><span class='line'>        435.919199 task-clock                #    1.028 CPUs utilized          
</span><span class='line'>               135 context-switches          #    0.000 M/sec                  
</span><span class='line'>                37 CPU-migrations            #    0.000 M/sec                  
</span><span class='line'>             4,203 page-faults               #    0.010 M/sec                  
</span><span class='line'>     1,278,164,688 cycles                    #    2.932 GHz                     [51.00%]
</span><span class='line'>   &lt;not supported> stalled-cycles-frontend 
</span><span class='line'>   &lt;not supported> stalled-cycles-backend  
</span><span class='line'>     1,649,473,158 instructions              #    1.29  insns per cycle         [76.19%]
</span><span class='line'>       454,492,126 branches                  # 1042.606 M/sec                   [74.86%]
</span><span class='line'>         1,593,299 branch-misses             #    0.35% of all branches         [74.27%]
</span><span class='line'>
</span><span class='line'>       0.424036750 seconds time elapsed
</span><span class='line'>
</span><span class='line'>test case:1
</span><span class='line'>
</span><span class='line'>branch predictor sequence length:3
</span><span class='line'>100000
</span><span class='line'>
</span><span class='line'> Performance counter stats for 'java GGG 1':
</span><span class='line'>
</span><span class='line'>        440.982464 task-clock                #    1.017 CPUs utilized          
</span><span class='line'>               134 context-switches          #    0.000 M/sec                  
</span><span class='line'>                 7 CPU-migrations            #    0.000 M/sec                  
</span><span class='line'>             4,202 page-faults               #    0.010 M/sec                  
</span><span class='line'>     1,313,300,847 cycles                    #    2.978 GHz                     [48.14%]
</span><span class='line'>   &lt;not supported> stalled-cycles-frontend 
</span><span class='line'>   &lt;not supported> stalled-cycles-backend  
</span><span class='line'>     1,691,221,085 instructions              #    1.29  insns per cycle         [74.32%]
</span><span class='line'>       464,577,389 branches                  # 1053.505 M/sec                   [76.70%]
</span><span class='line'>         1,860,782 branch-misses             #    0.40% of all branches         [75.40%]
</span><span class='line'>
</span><span class='line'>       0.433542282 seconds time elapsed
</span><span class='line'>
</span><span class='line'>test case:2
</span><span class='line'>
</span><span class='line'>branch predictor sequence length:4
</span><span class='line'>100000
</span><span class='line'>
</span><span class='line'> Performance counter stats for 'java GGG 2':
</span><span class='line'>
</span><span class='line'>        404.754545 task-clock                #    0.998 CPUs utilized          
</span><span class='line'>               134 context-switches          #    0.000 M/sec                  
</span><span class='line'>                 0 CPU-migrations            #    0.000 M/sec                  
</span><span class='line'>             4,201 page-faults               #    0.010 M/sec                  
</span><span class='line'>     1,205,179,492 cycles                    #    2.978 GHz                     [49.49%]
</span><span class='line'>   &lt;not supported> stalled-cycles-frontend 
</span><span class='line'>   &lt;not supported> stalled-cycles-backend  
</span><span class='line'>     1,458,990,354 instructions              #    1.21  insns per cycle         [75.24%]
</span><span class='line'>       376,194,631 branches                  #  929.439 M/sec                   [75.31%]
</span><span class='line'>         1,333,624 branch-misses             #    0.35% of all branches         [75.46%]
</span><span class='line'>
</span><span class='line'>       0.405460356 seconds time elapsed
</span><span class='line'>
</span><span class='line'>test case:3
</span><span class='line'>
</span><span class='line'>branch predictor sequence length:5
</span><span class='line'>99999
</span><span class='line'>
</span><span class='line'> Performance counter stats for 'java GGG 3':
</span><span class='line'>
</span><span class='line'>        672.566849 task-clock                #    0.998 CPUs utilized          
</span><span class='line'>               169 context-switches          #    0.000 M/sec                  
</span><span class='line'>                 0 CPU-migrations            #    0.000 M/sec                  
</span><span class='line'>             4,202 page-faults               #    0.006 M/sec                  
</span><span class='line'>     2,008,298,057 cycles                    #    2.986 GHz                     [49.48%]
</span><span class='line'>   &lt;not supported> stalled-cycles-frontend 
</span><span class='line'>   &lt;not supported> stalled-cycles-backend  
</span><span class='line'>     1,525,468,338 instructions              #    0.76  insns per cycle         [75.04%]
</span><span class='line'>       407,631,191 branches                  #  606.083 M/sec                   [75.57%]
</span><span class='line'>        23,903,519 branch-misses             #    5.86% of all branches         [75.13%]
</span><span class='line'>
</span><span class='line'>       0.673644531 seconds time elapsed
</span><span class='line'>
</span><span class='line'>test case:4
</span><span class='line'>
</span><span class='line'>branch predictor sequence length:8
</span><span class='line'>100000
</span><span class='line'>
</span><span class='line'> Performance counter stats for 'java GGG 4':
</span><span class='line'>
</span><span class='line'>        405.341190 task-clock                #    0.998 CPUs utilized          
</span><span class='line'>               129 context-switches          #    0.000 M/sec                  
</span><span class='line'>                 0 CPU-migrations            #    0.000 M/sec                  
</span><span class='line'>             4,204 page-faults               #    0.010 M/sec                  
</span><span class='line'>     1,207,034,902 cycles                    #    2.978 GHz                     [47.61%]
</span><span class='line'>   &lt;not supported> stalled-cycles-frontend 
</span><span class='line'>   &lt;not supported> stalled-cycles-backend  
</span><span class='line'>     1,464,313,449 instructions              #    1.21  insns per cycle         [73.32%]
</span><span class='line'>       373,966,105 branches                  #  922.596 M/sec                   [76.32%]
</span><span class='line'>         1,419,666 branch-misses             #    0.38% of all branches         [76.29%]
</span><span class='line'>
</span><span class='line'>       0.406078318 seconds time elapsed
</span><span class='line'>
</span><span class='line'>test case:5
</span><span class='line'>
</span><span class='line'>branch predictor sequence length:9
</span><span class='line'>100000
</span><span class='line'>
</span><span class='line'> Performance counter stats for 'java GGG 5':
</span><span class='line'>
</span><span class='line'>        794.795883 task-clock                #    0.998 CPUs utilized          
</span><span class='line'>               190 context-switches          #    0.000 M/sec                  
</span><span class='line'>                 0 CPU-migrations            #    0.000 M/sec                  
</span><span class='line'>             4,203 page-faults               #    0.005 M/sec                  
</span><span class='line'>     2,373,644,196 cycles                    #    2.986 GHz                     [49.22%]
</span><span class='line'>   &lt;not supported> stalled-cycles-frontend 
</span><span class='line'>   &lt;not supported> stalled-cycles-backend  
</span><span class='line'>     1,516,162,160 instructions              #    0.64  insns per cycle         [74.37%]
</span><span class='line'>       402,595,975 branches                  #  506.540 M/sec                   [75.37%]
</span><span class='line'>        36,324,079 branch-misses             #    9.02% of all branches         [75.57%]
</span><span class='line'>
</span><span class='line'>       0.796235469 seconds time elapsed
</span><span class='line'>
</span><span class='line'>test case:6
</span><span class='line'>
</span><span class='line'>branch predictor sequence length:16
</span><span class='line'>99999
</span><span class='line'>
</span><span class='line'> Performance counter stats for 'java GGG 6':
</span><span class='line'>
</span><span class='line'>        408.163870 task-clock                #    0.998 CPUs utilized          
</span><span class='line'>               136 context-switches          #    0.000 M/sec                  
</span><span class='line'>                 0 CPU-migrations            #    0.000 M/sec                  
</span><span class='line'>             4,202 page-faults               #    0.010 M/sec                  
</span><span class='line'>     1,214,173,766 cycles                    #    2.975 GHz                     [49.83%]
</span><span class='line'>   &lt;not supported> stalled-cycles-frontend 
</span><span class='line'>   &lt;not supported> stalled-cycles-backend  
</span><span class='line'>     1,533,685,373 instructions              #    1.26  insns per cycle         [75.45%]
</span><span class='line'>       412,685,366 branches                  # 1011.078 M/sec                   [75.54%]
</span><span class='line'>         1,366,491 branch-misses             #    0.33% of all branches         [74.87%]
</span><span class='line'>
</span><span class='line'>       0.408941737 seconds time elapsed
</span><span class='line'>
</span><span class='line'>test case:7
</span><span class='line'>
</span><span class='line'>branch predictor sequence length:17
</span><span class='line'>99999
</span><span class='line'>
</span><span class='line'> Performance counter stats for 'java GGG 7':
</span><span class='line'>
</span><span class='line'>        837.196938 task-clock                #    0.999 CPUs utilized          
</span><span class='line'>               165 context-switches          #    0.000 M/sec                  
</span><span class='line'>                 8 CPU-migrations            #    0.000 M/sec                  
</span><span class='line'>             4,202 page-faults               #    0.005 M/sec                  
</span><span class='line'>     2,497,386,962 cycles                    #    2.983 GHz                     [49.25%]
</span><span class='line'>   &lt;not supported> stalled-cycles-frontend 
</span><span class='line'>   &lt;not supported> stalled-cycles-backend  
</span><span class='line'>     1,514,795,880 instructions              #    0.61  insns per cycle         [75.21%]
</span><span class='line'>       401,526,259 branches                  #  479.608 M/sec                   [75.18%]
</span><span class='line'>        39,563,587 branch-misses             #    9.85% of all branches         [75.67%]
</span><span class='line'>
</span><span class='line'>       0.838282370 seconds time elapsed
</span><span class='line'>
</span><span class='line'>test case:8
</span><span class='line'>
</span><span class='line'>branch predictor sequence length:32
</span><span class='line'>100000
</span><span class='line'>
</span><span class='line'> Performance counter stats for 'java GGG 8':
</span><span class='line'>
</span><span class='line'>        747.169398 task-clock                #    1.006 CPUs utilized          
</span><span class='line'>               178 context-switches          #    0.000 M/sec                  
</span><span class='line'>                51 CPU-migrations            #    0.000 M/sec                  
</span><span class='line'>             4,199 page-faults               #    0.006 M/sec                  
</span><span class='line'>     2,231,730,222 cycles                    #    2.987 GHz                     [50.33%]
</span><span class='line'>   &lt;not supported> stalled-cycles-frontend 
</span><span class='line'>   &lt;not supported> stalled-cycles-backend  
</span><span class='line'>     1,630,954,802 instructions              #    0.73  insns per cycle         [75.53%]
</span><span class='line'>       438,123,215 branches                  #  586.377 M/sec                   [74.94%]
</span><span class='line'>        30,522,725 branch-misses             #    6.97% of all branches         [74.87%]
</span><span class='line'>
</span><span class='line'>       0.742440916 seconds time elapsed
</span><span class='line'>
</span><span class='line'>test case:9
</span><span class='line'>
</span><span class='line'>branch predictor sequence length:33
</span><span class='line'>100000
</span><span class='line'>
</span><span class='line'> Performance counter stats for 'java GGG 9':
</span><span class='line'>
</span><span class='line'>        970.124951 task-clock                #    1.006 CPUs utilized          
</span><span class='line'>               197 context-switches          #    0.000 M/sec                  
</span><span class='line'>                51 CPU-migrations            #    0.000 M/sec                  
</span><span class='line'>             4,202 page-faults               #    0.004 M/sec                  
</span><span class='line'>     2,897,829,158 cycles                    #    2.987 GHz                     [49.89%]
</span><span class='line'>   &lt;not supported> stalled-cycles-frontend 
</span><span class='line'>   &lt;not supported> stalled-cycles-backend  
</span><span class='line'>     1,615,586,420 instructions              #    0.56  insns per cycle         [75.29%]
</span><span class='line'>       432,153,910 branches                  #  445.462 M/sec                   [74.86%]
</span><span class='line'>        51,106,599 branch-misses             #   11.83% of all branches         [75.29%]
</span><span class='line'>
</span><span class='line'>       0.964319417 seconds time elapsed</span></code></pre></td></tr></table></div></figure>


<p>以上测试不严谨的地方在于没有多次测试并取平均值,但经过人肉的repeat和肉眼的分析来看,测试数据表现出的特征很明显,所有测试序列长度大于2的结果中,为2的幂次+1的结果都在分支预测上表现不理想,同时当序列长度等于32时,结果要明显高于小于等于16的2的幂次的结果.</p>

<p>这个场景很特别,也有很多值得思考的问题,目前没有很明确的答案,只有一些基本的猜测:</p>

<ol>
<li><p>仔细看看,发现if条件中的第二个表达式在内循环中由于i的不变性而保持不变,第一个条件虽然会发生变化,但其值具备很强的可预测性,因为在去掉第二个条件后,miss率降到3%左右.而将第二个表达式前提后,miss率也降低到3%.
这个现象十分之诡异,也难以解释,准备试试vtune,看能否采集到更精准的数据来分析.</p></li>
<li><p>计算机喜欢2的幂次</p>

<ul>
<li>刚毕业那会某大牛对我说,如果你要使用一个数字变量,尽量定义为2的幂次.当然长度16以后的性能剧降能间接的说明了解branch history长度的意义.</li>
<li>2的幂次+1带来的更多的随机性和资源的负担,我只能说记住第一条,但无法量化分析这个现象,如果真要分析,有机会进intel我会好好研究~.</li>
</ul>
</li>
</ol>


<h2>结论</h2>

<ol>
<li>2的幂次</li>
<li>优化hotspot,尽量消除不必要的分支,如果必须要使用,注意分析branch内表达式的随机性.</li>
<li>分析分支预测失败因子基于了解当前CPU内部架构的基础上.</li>
</ol>


<h2>参考</h2>

<ul>
<li><a href="http://zh.wikipedia.org/zh/%E5%88%86%E6%94%AF%E9%A0%90%E6%B8%AC%E5%99%A8">分支预测器</a></li>
<li><a href="http://software.intel.com/en-us/articles/avoiding-the-cost-of-branch-misprediction">intel开发者blog-如何避免分支预测失败的开销</a></li>
<li><a href="http://www.docin.com/p-86138919.html">某教授对各种类似CPU内部架构的分析和猜测, 专业!</a></li>
<li><a href="http://en.wikipedia.org/wiki/Loop_unwinding">loop unrolling</a></li>
<li><a href="http://www.cs.cmu.edu/afs/cs/academic/class/15740-f02/public/doc/discussions/uniprocessors/branch_pred/msmith_isca95.pdf">分支预测分析</a></li>
</ul>


<p>intel官方文档我没有找到对于分支预测的详细介绍,很多地方都是一笔带过.这里就不列举了.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2012/11/08/xun-huan-xiao-lu-de-jiu-jie/">循环效率的纠结</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2012-11-08T10:13:00+08:00" pubdate data-updated="true">Nov 8<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/11/08/xun-huan-xiao-lu-de-jiu-jie/#disqus_thread">Comments</a>
		 
	  </p>
    
  </header>


  <div class="entry-content"><h2>纠结</h2>

<p>两个嵌套的循环,一个假设10000000次,一个假设100次,把两个循环次数颠倒一下,是否存在性能差异的问题.</p>

<h2>解释执行</h2>

<p>从代码来分析,如果外层循环较大,则内层循环的循环变量会被更多次的使用,这是个隐性的开销,而内层循环里的代码,在两种情况下执行指令的次数是一致的,所以外层循环较大则性能较差.</p>

<h2>JIT</h2>

<p>通常循环达到一定的次数回边计数超过阀值,则触发JIT编译,而后上述基于栈的指令体系下出现的指令数差异则不复存在了,而需要看编译后的差异,这个差异在不同的机器上表现有些不一样,即使是同样的环境,而会略有不同,但用perf分析后,发现执行的指令数,耗时,分支预测错误率,线程cpu迁移都没有数量级的差异.可以说性能基本一致.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/3/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    
<section class="odd">
  <div class="hero-unit">
	<h1>Profile</h1>
	<p>
      <a class="btn btn-primary btn-large">一个程序员,思考着如何按自己的本性活着并为之努力

&#8220;I am not an academic. I have never even taken a computer science course.&#8221; &#8211;Leslie Lamport &#8220;Teaching Concurrency&#8221; 
      </a>
	</p>
  </div>
</section>


<section class="odd">
  <h1>Contact</h1>
  <p>
	<iframe width="100%" 
			height="100" 
			class="share_self"  
			frameborder="0" 
			scrolling="no" 
			src="http://widget.weibo.com/weiboshow/index.php?language=&width=100%&height=400&fansRow=2&ptype=0&speed=0&skin=2&isTitle=0&noborder=1&isWeibo=0&isFans=0&uid=1885742623&verifier=296b9670&dpc=1">
	</iframe> 
	<img src="/images/email_address.png" alt="powered by imagemagick:" class="img-rounded" />
  </p>
</section>

<section>
  <h1>Categories</h1>
    <ul id="category-list"><li><a href='/blog/categories/algorithm'>algorithm (1)</a></li><li><a href='/blog/categories/android'>android (2)</a></li><li><a href='/blog/categories/app'>app (1)</a></li><li><a href='/blog/categories/architecture'>architecture (1)</a></li><li><a href='/blog/categories/berkeley-db'>Berkeley DB (1)</a></li><li><a href='/blog/categories/branch-predictor'>branch predictor (1)</a></li><li><a href='/blog/categories/c'>c (1)</a></li><li><a href='/blog/categories/cas'>cas (1)</a></li><li><a href='/blog/categories/dag'>dag (1)</a></li><li><a href='/blog/categories/dalvik'>dalvik (1)</a></li><li><a href='/blog/categories/debug'>debug (1)</a></li><li><a href='/blog/categories/endian'>endian (1)</a></li><li><a href='/blog/categories/flipboard'>flipboard (1)</a></li><li><a href='/blog/categories/fp'>FP (1)</a></li><li><a href='/blog/categories/fragmantation'>fragmantation (1)</a></li><li><a href='/blog/categories/gc'>gc (1)</a></li><li><a href='/blog/categories/git'>git (1)</a></li><li><a href='/blog/categories/java'>java (1)</a></li><li><a href='/blog/categories/jit'>jit (1)</a></li><li><a href='/blog/categories/jvm'>JVM (1)</a></li><li><a href='/blog/categories/life'>life (1)</a></li><li><a href='/blog/categories/ltrace'>ltrace (1)</a></li><li><a href='/blog/categories/malloc'>malloc (2)</a></li><li><a href='/blog/categories/memory'>memory (1)</a></li><li><a href='/blog/categories/netease'>netease (1)</a></li><li><a href='/blog/categories/network'>network (1)</a></li><li><a href='/blog/categories/oop'>OOP (1)</a></li><li><a href='/blog/categories/parallel'>parallel (1)</a></li><li><a href='/blog/categories/perf'>perf (1)</a></li><li><a href='/blog/categories/performance'>performance (5)</a></li><li><a href='/blog/categories/profile'>profile (1)</a></li><li><a href='/blog/categories/protocol-buffer'>protocol buffer (1)</a></li><li><a href='/blog/categories/reader'>reader (1)</a></li><li><a href='/blog/categories/system'>system (1)</a></li><li><a href='/blog/categories/tcp'>TCP (1)</a></li><li><a href='/blog/categories/vcs'>vcs (1)</a></li><li><a href='/blog/categories/weak-reference'>weak reference (1)</a></li><li><a href='/blog/categories/zaker'>zaker (1)</a></li><li><a href='/blog/categories/互联网'>互联网 (1)</a></li><li><a href='/blog/categories/公共子表达式'>公共子表达式 (1)</a></li><li><a href='/blog/categories/分支预测'>分支预测 (1)</a></li><li><a href='/blog/categories/回忆'>回忆 (1)</a></li><li><a href='/blog/categories/年终总结'>年终总结 (1)</a></li><li><a href='/blog/categories/并行编程'>并行编程 (1)</a></li><li><a href='/blog/categories/序列化'>序列化 (1)</a></li><li><a href='/blog/categories/思考'>思考 (3)</a></li><li><a href='/blog/categories/性能'>性能 (1)</a></li><li><a href='/blog/categories/技术分析'>技术分析 (1)</a></li><li><a href='/blog/categories/操作系统'>操作系统 (1)</a></li><li><a href='/blog/categories/目标'>目标 (1)</a></li><li><a href='/blog/categories/编码'>编码 (1)</a></li><li><a href='/blog/categories/编译优化'>编译优化 (1)</a></li><li><a href='/blog/categories/翻译'>翻译 (2)</a></li><li><a href='/blog/categories/计算'>计算 (1)</a></li><li><a href='/blog/categories/计算机体系结构'>计算机体系结构 (1)</a></li><li><a href='/blog/categories/通讯协议'>通讯协议 (1)</a></li><li><a href='/blog/categories/阿里'>阿里 (1)</a></li><li><a href='/blog/categories/高性能'>高性能 (1)</a></li></ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/01/04/2013/">2013</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/12/30/2013-que-ding-fang-xiang-de-%5B%3F%5D-nian/">2013-确定方向的一年</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/08/30zhi-hou-de-zhi-xiang/">30之后的志向</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/27/po-ju-zhe/">破局者</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/04/17/ji-suan-mi-ji-xing-cao-zuo-you-hua-tan-jiu/">&#8216;计算密集型操作优化探究&#8217;</a>
      </li>
    
  </ul>
</section>






  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Songjie Dong -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> Theme by <a href="http://melandri.net">@alemelandri</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'dongsongjie';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
